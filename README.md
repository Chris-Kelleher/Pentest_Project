## Red Team and Blue Team Penetration Test and Reporting Project

The tactics, techniques, methods and procedures in this repository were used during an authorized penetration test and were compiled into a written report.  

This project was split into three phases to provide insight about how an attack may occur, how the incident response team analyzes the logs to discover the attack, and provide a report detailing the attack along with mitigation strategies.  

The Red Team phase will cover:

 - Network Discovery
 - OSINT
 - Brute Force Attacks
 - Breaking encryption
 - Researching vulnerabilities
 - Creating and deploying exploits 

The Blue Team phase will cover analyzing:

 - Metricbeat log data for operating system metrics
 - Filebeat Log data for folder and file data
 - Packetbeat log data for network traffic

The reporting phase will provide a report summariazing the egagement and providing:

 - The methods and tools used to exploit the vilnerabilities disovered
 - The log data used to discover evidence of the attack
 - Mitigation strategies for hardening the network from future attacks


### Network Topology

This is a virtual network created within Microsoft Azure for educational purposes.

This virtual network is depicted below:

- [Network Diagram](https://user-images.githubusercontent.com/62370968/120056842-5e559000-c004-11eb-8862-4b756be20ec9.jpg)

The main purpose of this network is to expose a web server to an penetration test and have the ELK machine capture log data for data analysis to gain visibility of the attack vectors.  It should be noted that for this project all machines were located on the same subnet.  

The configuration details of each machine may be found below.

| Name     | Function | IP Address      | Operating System |
|----------|----------|-----------------|------------------|
| Kali     | Attacker | 192.168.1.90    | Linux            |
| Capstone | Target   | 192.168.1.105   | Windows - Apache |
| ELK      | Elk Stack| 192.168.1.100   | Windows          |

The attacker machine used was a VM operating with 5.10.0-Kali7-amd64
The target machine used was a VM operating with Windows as an Apache web server.
The Elk Stack machine was a VM operating Windows as an Elk Stack server.  

The Capstone machine (apache server) was configured with Kibana and utilized the following log data capture agents:

 - Metricbeat
 - Filebeat
 - Packetbeat

### Red Team Phase

To gain a picture of the network landscape we first determined our ip address using the command line entry:  

 - IP addr provided an IP address of 192.168.1.90/24 as shown with this [Screenshot](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/Identifying%20the%20subnet.jpg?raw=true)

Nmap was used to perform a scan of the subnet using the command line entry: 

 - nmap -sX 192.168.1.0/24 as seen in this [Screenshot](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/copy%20nmap%20scan%20of%20subnet.jpg)

With the identification of a web server at 192.168.1.105, firefox was opened and an OSINT investigation found the following page with open sensitive data:

 - This page is viewable in this [Screenshot](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/OSINT%20showing%20secret%20folder%20structure.jpg)  

 - Upon entering the path to the "Secret Folder", we were provided a login page depicted in this [Screenshot](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/secret%20folder%20auth%20page%20confirming%20ashton%20as%20user%20name.jpg)

A brute force attack was initiated against this page using the hydra tool, with the username "ashton" as discovered by OSINT.  The hydra command was 
hydra -l ashton -P /usr/share/wordlists/rockyou.txt -f -vV http-get://192.168.1.105/company_folders/secret_folder.
 
 - We discovered ashton's password as shown [In this Capture](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/6.%20ashton%20password%20crack.jpg)

Upon entering the credentials and gaining access, we located the following page which provided the user name ryan. 

 - We broke the encryption using the website CrackStation (https://crackstation.net) and learned Ryan's [password](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/ryan%20hash%20crack%20unsalted.jpg)

We researched vulnerabilities with WebDav and discovered:

 - [CVE 2006-2849](https://nvd.nist.gov/vuln/detail/CVE-2006-2849), which provides for remote file inclusion.

Using msfvenom, we created a PHP payload:

 - A [reverse_tcp connection](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/creating%20the%20payload.jpg) to our kali machine.

We then logged into to the web server via WebDav:

 - Placing the [payload](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/exploit%20payload%20placed%20onto%20company%20server.jpg), opening the connection and discovering the [flag](https://github.com/Chris-Kelleher/Pentest_Project/blob/main/Images/discovered%20the%20secret%20flag.jpg) 

### Final Report

The Blue Team analysis and the final report can be seen [Here](https://docs.google.com/presentation/d/e/2PACX-1vTmuxHTLDTYqT-JHwYj9fITB48U52bXYk-jKfAdJBZBNEhKw2hMax5tsZg-dQcBlyiJwBcDEtUJqkAV/pub?start=true&loop=false&delayms=5000)
